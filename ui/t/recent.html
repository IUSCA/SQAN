<sca-menubar menu="menu.top" active="'dicom'" profile="menu._profile"></sca-menubar>
<sca-menutab menu="serverconf.menu" active="'recent'"></sca-menutab>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-3" ng-class="{affix: content_affix}">
            <div ng-repeat="(iibisid, research) in researches">
                <h4>IIBISID: {{iibisid}}</h4>
                <div class="list-group">
                    <div class="list-group-item" ng-repeat="(modality_id, modality) in research.modalities">
                        <h4 class="list-group-item-heading">
                            {{modality._detail.Modality}} / {{modality._detail.StationName}}
                            <small ng-if="modality._detail.Modality == 'PT'">
                                / {{modality._detail.radio_tracer}}
                            </small>
                        </h4>
                        <p class="list-group-item-text">
                            <ol class="subjects">
                                <li ng-repeat="(subject_id, subject) in modality.subjects" 
                                    ng-click="scrollto(subject.uid)"
                                    ng-class="{inview: inview_id == subject.uid}"> 
                                    <!--subject_id is not unique across all iibisid / modality..-->
                                    <a href="javascript:void(0)">
                                        <span ng-if="subject.oks != 0" class="label label-success">{{subject.oks}} OKs</span>
                                        <span ng-if="subject.errors != 0" class="label label-danger">{{subject.errors}} Errors</span>
                                        <span ng-if="subject.warnings != 0" class="label label-warning">{{subject.warnings}} Warnings</span>
                                        <span ng-if="subject.notemps != 0" class="label label-primary">{{subject.notemps}} NoTemps</span>
                                        <span ng-if="subject.non_qced != 0" class="label label-info" ng-if="!study.qc">{{subject.non_qced}} Not Yet QCed</span>
                                        {{subject_id}}
                                    </a>
                                </li>
                                <li ng-click="scrollto(iibisid+modality_id)"
                                    ng-class="{inview: inview_id == iibisid+modality_id}"> 
                                    <a href="javascript:void(0)">
                                        <!--<span class="label label-default">OK</span>-->
                                        Templates
                                    </a>
                                </li>
                            </ol>
                        </p>
                    </div>
                </div>
            </div><!--ng-repeat-->
        </div> <!--col-md-3-->

        <div class="col-md-9" ng-class="{'col-md-offset-3': content_affix}">
            <div ng-repeat="(iibisid, research) in researches">
                <h2>IIBISID: {{iibisid}}</h2>
                <div ng-repeat="(modality_id, modality) in research.modalities">
                    <h3>
                        Modality: <b>{{modality._detail.Modality}}</b> 
                        StationName: <b>{{modality._detail.StationName}}</b>
                        <small ng-if="modality._detail.Modality == 'PT'">
                            RadioTracer: <b>{{modality._detail.radio_tracer}}</b>
                        </small>
                    </h3>
                    
                    <div id="{{subject.uid}}" class="panel panel-default subject" ng-repeat="(subject_id, subject) in modality.subjects"> 
                        <div class="panel-heading"><span class="text-muted">Subject</span> {{subject_id}}</div>
                        <div class="panel-body">
                            <table class="table table-condensed" style="margin-bottom: 0px;">
                                <thead><tr><th width="30%">Series Description</th><th>Studies <span class="text-muted">(Series Number)</span></th></tr></thead>
                                <tbody>                     
                                    <tr ng-repeat="series in subject.serieses | orderDetailBy:'series_desc'">
                                        <td>{{series._detail.series_desc}}</td>
                                        <td style="padding: 1px 5px;">
                                            <ul class="studies">
                                                <li ng-repeat="(study_id, study) in series.studies" ng-click="openstudy(study_id)">
                                                    <span class="label label-info" ng-if="!study.qc">Not Yet QCed</span>
                                                    <span class="label label-primary" ng-if="study.qc.notemps > 0">NoTemp: {{study.qc.notemps}}</span>
                                                    <span class="label label-danger" ng-if="study.qc.errors.length > 0">Errors: {{study.qc.errors.length}}</span>
                                                    <span class="label label-warning" ng-if="study.qc.warnings.length > 0">Warnings: {{study.qc.warnings.length}}</span>
                                                    <span class="label label-success" ng-if="study.qc.warnings.length == 0 && study.qc.errors.length == 0 && study.qc.notemps == 0">OK</span>
                                                    <time>{{study.StudyTimestamp | date:'medium' }}</time> <span class="text-muted">(#{{study.SeriesNumber}})</span>
                                                </li> 
                                            </ul>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="{{iibisid+modality_id}}" class="panel panel-default template">
                        <div class="panel-heading panel-heading-template">Templates</div>
                        <div class="panel-body panel-body-template">
                            <table class="table table-condensed" style="margin-bottom: 0px;">
                                <thead><tr><th width="30%">Series Description</th><th>Templates</th></tr></thead>
                                <tbody>                     
                                    <tr ng-repeat="series in modality.template.serieses | orderDetailBy:'series_desc'">
                                        <td>{{series._detail.series_desc}}</td>
                                        <td style="padding: 1px 5px;">
                                            <ul class="templates">
                                                <li ng-repeat="(template_id, template) in series.templates">
                                                    {{template.date | date:'medium'}} (#{{template.SeriesNumber}})
                                                </li> 
                                            </ul>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div> 
                    
                </div><!--modality-->
            </div><!--research-iibisid-->
        </div><!--col-md-9-->

    </div><!--row-->
</div>

